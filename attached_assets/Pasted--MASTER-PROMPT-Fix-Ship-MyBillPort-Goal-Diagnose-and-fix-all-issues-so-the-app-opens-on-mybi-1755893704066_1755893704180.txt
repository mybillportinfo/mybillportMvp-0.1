üü¶ MASTER PROMPT ‚Äî Fix & Ship MyBillPort

Goal: Diagnose and fix all issues so the app opens on mybillport.com, bills load in real‚Äëtime, Plaid connects, Stripe payments work (with webhook), and errors are surfaced clearly. Produce a final report and working deployment.

Assume: I already have valid Firebase, Plaid, Stripe secrets in Replit. Do not ask me questions; assume sensible defaults and proceed.

0) Baseline & constraints

Stack: React (or Vite) + Node/Express (or existing server), Firebase Auth + Firestore, Stripe, Plaid.

Keep current design/branding; minimize UI churn.

If something is missing, add it with minimal changes; leave comments // TODO: Randeep.

1) Triage ‚Äúapp won‚Äôt open / links don‚Äôt work‚Äù

Check Replit console errors, package.json scripts, dev server port, and CORS.

Fix build/start scripts. Ensure:

"scripts": {
  "dev": "vite || react-scripts start || node server/index.js",
  "start": "node server/index.js",
  "build": "vite build || react-scripts build"
}


If using client+server, proxy /api/* to server or serve static build from server.

Add /api/health route ‚Üí returns { ok:true, time:<iso> }.

Add a catch‚Äëall route to serve the SPA index for unknown paths (prevents 404 on refresh).

Accept: Visiting root shows the app (no blank page); /api/health returns JSON 200.

2) Environment & secrets sanity (no prompts)

Create a config audit (scripts/configAudit.{ts|js} + /admin/config-report) that checks and prints ‚úÖ/‚ùå for:

Firebase: VITE_FIREBASE_API_KEY, VITE_FIREBASE_PROJECT_ID, VITE_FIREBASE_APP_ID, FIREBASE_SERVICE_ACCOUNT_KEY.

Plaid: PLAID_CLIENT_ID, PLAID_SECRET, PLAID_ENV.

Stripe: STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET (optional until webhook set).

App URLs: PUBLIC_APP_URL (default https://mybillport.com).

If any missing, show actionable fix text in the report and console.

Accept: /admin/config-report loads and shows green checks (or clear ‚ùå with fix).

3) Fix Firebase ‚Äúauth/invalid-credential‚Äù

Re‚Äëinit Admin SDK using FIREBASE_SERVICE_ACCOUNT_KEY JSON (single line).

Client config must read VITE_ vars.

Verify Firestore read/write via a tiny test route (/api/firebase-test) that creates a doc in diagnostics/hello and reads it back.

Rules (re‚Äëdeploy if needed):

rules_version = '2';
service cloud.firestore {
  match /databases/{db}/documents {
    function isSelf(data) { return request.auth != null && request.auth.uid == data.userId; }
    function isCreateForSelf() { return request.auth != null && request.resource.data.userId == request.auth.uid; }

    match /users/{uid}          { allow read, write: if request.auth != null && request.auth.uid == uid; }
    match /bills/{id}           { allow create: if isCreateForSelf(); allow read, update, delete: if isSelf(resource.data); }
    match /plaid_txns/{id}      { allow create: if isCreateForSelf(); allow read, update, delete: if isSelf(resource.data); }
    match /notifications/{id}   { allow create: if isCreateForSelf(); allow read, update, delete: if isSelf(resource.data); }
  }
}


Accept: No more auth/invalid-credential. /api/firebase-test returns success.

4) Make the Add Bill ‚Üí Dashboard flow bulletproof

Form fields: accountNumber, amount, dueDate (required). Optional: leadDays (1/3/7 default 3), frequency (monthly default). name from dropdown + free text.

On submit: write to bills with { userId, name, accountNumber, amount:Number, dueDate:Timestamp, frequency, leadDays, paid:false, createdAt:serverTimestamp() }.

Dashboard query: user‚Äëscoped, unpaid only, ordered by dueDate asc. Use onSnapshot for real‚Äëtime updates.

Sections: Overdue / Due Soon (‚â§7 days) / Others. Inline errors + success toasts.

Accept: New bill appears immediately without reload and in the correct section.

5) Stripe checkout + webhook (mark bill paid)

/api/checkout accepts { billId, billName, amount, email } and creates a Checkout Session with metadata.billId.

/stripe/webhook uses raw body and STRIPE_WEBHOOK_SECRET. On checkout.session.completed: mark bills/{billId}.paid=true, paidAt.

Add a Pay button on each unpaid bill ‚Üí POST /api/checkout then redirect to session.url.

Accept: Test checkout (test card) ‚Üí webhook fires ‚Üí bill flips to paid and disappears live.

6) Plaid link + sync (basic)

/api/create_link_token ‚Üí create link token for current user.

/api/exchange_public_token ‚Üí store access_token on user doc.

/api/transactions/sync ‚Üí fetch last 30‚Äì90 days; store in plaid_txns.

Simple recurring detector ‚Üí build suggested_bills in memory or collection; one‚Äëclick Add prefilled.

Accept: Sandbox institution links; /api/transactions/sync stores txns; suggested bills render.

7) Email reminders (and test)

Email provider: use existing MailerSend/SendGrid keys if present; else stub with console log but keep API shape.

sendBillReminderEmail() and sendPaymentRequestEmail() utilities + /api/email-test posting to TEST_EMAIL.

Scheduled job (cron or functions) daily 06:00 UTC: for each user, send reminder where paid=false and dueDate - today == leadDays. Log to notifications.

Accept: /api/email-test returns 2xx; reminders create logs on schedule (or manual trigger).

8) Domain & routing

Ensure HTTPS and CORS correct. Force HTTPS redirects.

Make sure mybillport.com and www both resolve. SPA catch‚Äëall prevents 404 on refresh.

Confirm /stripe/webhook reachable from Stripe dashboard (send test event).

Accept: App loads on https://mybillport.com and Stripe test events show 200 OK.

9) Developer ergonomics

Add meaningful error toasts in UI and structured logs in server (with request IDs).

Add README.md with:

Env vars list and sample .env

Test routes: /api/health, /api/firebase-test, /admin/config-report, /api/email-test, /api/transactions/sync

How to test Stripe webhook & Plaid sandbox

Common pitfalls (raw webhook body, service account JSON formatting, Firestore indexes)

Add npm scripts:

"scripts": {
  "dev": "vite",
  "start": "node server/index.js",
  "build": "vite build",
  "config:audit": "node scripts/configAudit.js"
}

10) Deliverables

Working deployment at https://mybillport.com.

All tests (health, firebase-test, email-test, checkout, webhook, plaid sync) pass.

Push to GitHub (rsingh4545/mybillport) and attach a ZIP artifact.

Post a final summary in console with:

What was fixed

Any non‚Äëblocking TODOs

Exact env vars required and their status

Links to test routes and latest commit hash

üîë Secrets (expected in Replit)
VITE_FIREBASE_API_KEY
VITE_FIREBASE_PROJECT_ID
VITE_FIREBASE_APP_ID
FIREBASE_SERVICE_ACCOUNT_KEY   // JSON single line

PLAID_CLIENT_ID
PLAID_SECRET
PLAID_ENV=sandbox

STRIPE_SECRET_KEY
STRIPE_WEBHOOK_SECRET          // after endpoint is created in Stripe
PUBLIC_APP_URL=https://mybillport.com

MAILERSEND_API_KEY or SENDGRID_API_KEY
FROM_EMAIL
FROM_NAME
TEST_EMAIL

‚úÖ Definition of Done

Site opens reliably (no blank screens), health route green.

Add Bill works; bills update live; clean UX with toasts.

Stripe test checkout marks bill paid via webhook without manual refresh.

Plaid link + transaction sync functional; suggested bills visible.

Email test returns 2xx; scheduled reminders log entries.

Config report shows ‚úÖ across Firebase/Plaid/Stripe/Email (or exact fix steps).

Code pushed & ZIP exported; summary printed.