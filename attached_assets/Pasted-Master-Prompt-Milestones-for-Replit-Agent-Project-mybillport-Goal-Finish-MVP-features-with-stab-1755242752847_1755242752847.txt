Master Prompt (Milestones for Replit Agent)

Project: mybillport
Goal: Finish MVP features with stable email, billing, Plaid ingestion, reminders, and clean dashboards. Push to GitHub and export ZIP.

⸻

M1 — Email sending that actually works

Do:
	•	Integrate MailerSend (fallback: SendGrid).
	•	Secrets to read:

MAILERSEND_API_KEY or SENDGRID_API_KEY
FROM_EMAIL (verified sender)
FROM_NAME (e.g., MyBillPort)
TEST_EMAIL

•	Create services/email.(ts|js) with:
	•	sendPaymentRequestEmail({to, name, amount, note, link?})
	•	sendBillReminderEmail({to, billName, amount, dueDate})
	•	Add /email-test route to send to TEST_EMAIL and render HTTP status + body.
	•	Surface clear UI errors (e.g., “sender domain not verified”).

Deliverables:
	•	/email-test returns 2xx.
	•	“Request Money” button shows success/failure with readable reason.

We will provide (you’ll prompt me if missing): MAILERSEND_API_KEY, FROM_EMAIL, FROM_NAME, TEST_EMAIL.

⸻

M2 — Payments: quick path now, flexible later

Do (quickest):
	•	Add Stripe Payment Links support.
	•	Secret: STRIPE_SECRET_KEY (optional; if absent, skip).
	•	If present, create a payment link for {amount, description} and include in the payment‑request email.

Later options (don’t implement now):
	•	PayPal Invoicing API
	•	Interac e‑Transfer Request Money via partner bank

Deliverables:
	•	If Stripe key is present, payment request email includes a working Stripe link.

⸻

M3 — Plaid backend completion + recurring detection

Do:
	•	Add API routes:
	•	/api/create_link_token → Plaid Link token (Sandbox)
	•	/api/exchange_public_token → store access_token per user
	•	/api/transactions/sync → fetch latest txns for the user
	•	Store transactions in Firestore under plaid_txns (by user).
	•	Recurring detection:
	•	Identify merchants with repeating cadence (e.g., Rogers, Netflix, Hydro, Enbridge).
	•	Build suggested_bills with {name, averageAmount, lastSeen, cadenceGuess, accountNumber?}.
	•	Add a UI panel “Suggested Bills” → Add with one click.

Deliverables:
	•	After linking a sandbox institution, /api/transactions/sync stores txns.
	•	“Suggested Bills” shows recurring vendors; user can one‑click add.

We will provide (already have): PLAID_CLIENT_ID, PLAID_SECRET, PLAID_ENV=sandbox.

⸻

M4 — Simplify “Add Bill” (your exact spec)

Replace with:
	•	Required: accountNumber, amount, dueDate
	•	Optional: leadDays (1/3/7; default 3), frequency (monthly default)
	•	name from dropdown (Rogers, Bell, Telus, Hydro One, Enbridge, Netflix, Spotify, Amazon Prime) + free‑text fallback.

Schema (bills):

{
  "userId": "<auth.uid>",
  "name": "Rogers",
  "accountNumber": "12345",
  "amount": 95.50,
  "dueDate": "<Timestamp>",
  "frequency": "monthly",
  "leadDays": 3,
  "paid": false,
  "createdAt": "<serverTimestamp>"
}

Deliverables:
	•	Form has only these fields, validations inline, success toast, close on create.

⸻

M5 — Reminder engine (scheduled + manual)

Do:
	•	Scheduled job (Cloud Function or cron) daily at a fixed UTC hour:
	•	Query: bills where paid=false and difference(dueDate,today) == leadDays.
	•	Send sendBillReminderEmail(...).
	•	Log to notifications.
	•	Manual trigger “Send Reminder Now” on /firebase-test.

Deliverables:
	•	Reminders are sent when date matches; manual trigger works and logs.

⸻

M6 — Dashboard correctness (instant + ordered)

Do:
	•	Query bills for current auth.uid, paid=false, order by dueDate asc.
	•	Sections:
	•	Overdue (dueDate < today)
	•	Due Soon (≤7 days)
	•	All Others
	•	Use onSnapshot (or refetch after create) so new bills appear at once.

Deliverables:
	•	Adding any bill shows immediately in the correct section, no reload needed.

⸻

M7 — Security & Config

Do:
	•	Firestore rules: allow create/read/update only if request.auth.uid == resource.data.userId (or new doc’s userId for create).
	•	Add /admin/config-report + script npm run config:audit that prints ✅/❌ for:
	•	Firebase keys present
	•	Mailer keys and sender verified
	•	(Optional) Stripe key present
	•	Domain (A record & TXT verify present)

Deliverables:
	•	Rules deployed.
	•	/admin/config-report renders a clear checklist.

⸻

M8 — Docs, GitHub, ZIP

Do:
	•	Update README.md:
	•	All env vars
	•	Minimal bill schema
	•	Test routes: /email-test, /firebase-test, /admin/config-report
	•	Troubleshooting (email domain verify, Firestore rules, missing index)
	•	Push to github.com/rsingh4545/mybillport
	•	Export ZIP artifact

Deliverables:
	•	Commit hash printed and ZIP link attached.

⸻

Prompt me if missing any secret:
	•	MAILERSEND_API_KEY (or SENDGRID_API_KEY)
	•	FROM_EMAIL, FROM_NAME
	•	(optional) STRIPE_SECRET_KEY

⸻

Definition of Done (quick check)
	•	We will add a “Rogers” bill and see it instantly on the dashboard, correctly sorted.
	•	We will click “Request Money” and an email will send (2xx), with Stripe link if configured.
	•	Reminders will send on schedule and via manual trigger.
	•	/admin/config-report shows green checks or explains exactly what to fix.
	•	Code pushed + ZIP delivered.

⸻

If you want, we will also draft your Privacy Policy and Terms of Service (needed for Plaid production & email providers).
